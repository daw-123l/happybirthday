<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Birthday Cake — Works Everywhere</title>

  <!-- Всё CSS встроено, чтобы гарантировать совместимость -->
  <style>
    :root{
      --bg1:#ffecd2;
      --bg2:#fcb69f;
      --cake-main:#e88f6b;
      --cake-cream:#ffe9d6;
      --plate:#f0f0f6;
      --candle:#fff;
      --flame-inner: #ffd74d;
      --flame-outer: rgba(255,160,60,0.18);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: radial-gradient(circle at 10% 10%, #fff6f0 0%, var(--bg1) 20%, var(--bg2) 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }

    /* Контейнер сцены */
    .stage{
      width: min(860px, 94vw);
      height: min(560px, 86vh);
      perspective: 1200px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }

    /* Каркас камеры */
    .scene{
      width:100%;
      height:100%;
      transform-style:preserve-3d;
      transition: transform 400ms cubic-bezier(.2,.8,.2,1);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* Торт (несколько "ярусов" цилиндров) */
    .cake {
      transform-style: preserve-3d;
      position: relative;
      width: 380px;
      height: 220px;
      transform: rotateX(18deg) rotateY(-12deg) translateZ(0);
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events: none;
    }

    /* слой — основа цилиндра (вид спереди) */
    .layer {
      position:absolute;
      left:50%;
      transform-style:preserve-3d;
      transform-origin: center center;
      translate: -50% -50%;
      display:block;
      border-radius: 50%;
      box-shadow: 0 12px 30px rgba(0,0,0,0.12), inset 0 -12px 24px rgba(0,0,0,0.06);
    }

    /* база (нижний ярус) */
    .layer.bottom {
      width: 360px;
      height: 120px;
      background: linear-gradient(180deg, #f9b79e 0%, var(--cake-main) 60%);
      z-index: 10;
      transform: translate(-50%, -15px) translateZ(-20px);
    }

    .layer.middle {
      width: 300px;
      height: 100px;
      background: linear-gradient(180deg, #ffd7c0 0%, var(--cake-main) 60%);
      z-index: 20;
      transform: translate(-50%, -70px) translateZ(30px) scale(0.85);
    }

    .layer.top {
      width: 210px;
      height: 84px;
      background: linear-gradient(180deg, var(--cake-cream) 0%, #ffd6b9 50%, var(--cake-main) 100%);
      z-index: 30;
      transform: translate(-50%,-120px) translateZ(80px) scale(0.62);
    }

    /* верхняя «кремовая» полоса (имитация верхушки) */
    .cream {
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      top: -40%;
      width: 88%;
      height: 36%;
      border-radius: 40% 40% 60% 60% / 50% 50% 60% 60%;
      background: linear-gradient(180deg, #fff7ee, #ffe9d6);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,0.08));
      z-index: 40;
    }

    /* тарелка */
    .plate {
      position:absolute;
      width: 520px;
      height: 100px;
      left:50%;
      transform: translate(-50%, 140px) rotateX(86deg) translateZ(-40px);
      background: radial-gradient(circle at 50% 20%, #ffffff, var(--plate));
      border-radius:50%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.12);
      z-index:0;
    }

    /* свечи — несколько элементов */
    .candles{
      position:absolute;
      top:8%;
      left:50%;
      transform: translateX(-50%) translateZ(110px) translateY(-10px);
      display:flex;
      gap: 18px;
      z-index:50;
      pointer-events:auto;
    }

    .candle{
      width:8px;
      height:56px;
      background: linear-gradient(180deg, #ffffff 0%, #eee 60%);
      border-radius:4px;
      position:relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.12), inset 0 -4px 6px rgba(0,0,0,0.04);
      transform-origin: center bottom;
      transform: rotateX(24deg) translateZ(0px);
    }

    /* свечной фитиль */
    .candle:after{
      content:'';
      position:absolute;
      top:-8px;
      left:50%;
      transform:translateX(-50%);
      width:4px;
      height:8px;
      background:#2b2b2b;
      border-radius:2px;
    }

    /* пламя — две части чтобы дать объём */
    .flame{
      position:absolute;
      top:-28px;
      left:50%;
      transform:translateX(-50%) translateZ(6px);
      width:10px;
      height:22px;
      border-radius:50% 50% 50% 50%;
      background: linear-gradient(180deg, var(--flame-inner), #ff8a00);
      box-shadow: 0 0 20px var(--flame-outer), 0 0 6px rgba(255,200,50,0.8);
      animation: flicker 1.45s infinite ease-in-out;
      transform-origin:50% 80%;
      z-index:70;
    }

    .flame.small{
      width:6px;
      height:14px;
      top:-20px;
      opacity:0.9;
      animation-duration:1s;
      background: linear-gradient(180deg, #fff17d, #ffb94d);
      filter: blur(.2px);
    }

    @keyframes flicker {
      0% { transform: translateX(-50%) translateZ(6px) rotate(0deg) scale(1); opacity:1; }
      20% { transform: translateX(-50%) translateZ(5px) rotate(-3deg) scale(0.96); opacity:0.95; }
      40% { transform: translateX(-50%) translateZ(7px) rotate(3deg) scale(1.02); opacity:1; }
      60% { transform: translateX(-50%) translateZ(5px) rotate(-2deg) scale(0.98); opacity:0.97; }
      80% { transform: translateX(-50%) translateZ(6px) rotate(1.5deg) scale(1); opacity:0.99; }
      100% { transform: translateX(-50%) translateZ(6px) rotate(0deg) scale(1); opacity:1; }
    }

    /* небольшой декор на торте (шарики глазури) */
    .sprinkles{
      position:absolute;
      width:100%;
      height:100%;
      left:0;
      top:0;
      pointer-events:none;
      z-index:45;
      transform:translateZ(90px);
    }
    .sprinkle{
      position:absolute;
      width:8px;
      height:6px;
      border-radius:6px;
      transform:rotate(20deg);
      background:linear-gradient(180deg,#fff,#ffe0e0);
      box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }

    /* подпись */
    .caption{
      position:absolute;
      bottom:16px;
      width:100%;
      text-align:center;
      font-weight:600;
      color:#8b5a4a;
      letter-spacing:0.6px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
      user-select:none;
      z-index:200;
    }

    /* Удобство: управление сценой — курсор/тач */
    .controls{
      position:absolute;
      right:12px;
      top:12px;
      display:flex;
      gap:8px;
      z-index:300;
      font-size:13px;
      color:#fff;
      text-shadow:0 1px 0 rgba(0,0,0,0.24);
    }
    .btn{
      background: rgba(0,0,0,0.18);
      padding:8px 10px;
      border-radius:8px;
      backdrop-filter: blur(4px);
      cursor:pointer;
      user-select:none;
    }
    .btn:active{ transform:translateY(1px); }

    /* респонсив */
    @media (max-width:520px){
      .cake{ width:280px; height:160px; transform: rotateX(16deg) rotateY(-8deg) }
      .plate{ width:360px; height:86px; transform: translate(-50%,120px) rotateX(86deg) translateZ(-24px); }
      .candles{ gap:12px; transform: translateX(-50%) translateZ(90px) translateY(-4px); }
    }

  </style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="scene" id="scene">
      <div class="cake" id="cake">
        <div class="layer bottom"></div>
        <div class="layer middle"></div>
        <div class="layer top"></div>
        <div class="cream"></div>

        <!-- Украшения – шарики-глазурь (рандомно расположим через JS ниже) -->
        <div class="sprinkles" id="sprinkles"></div>

        <!-- Свечи -->
        <div class="candles" aria-hidden="true">
          <div class="candle" style="transform: rotateX(22deg) translateZ(130px) translateY(-10px);"><span class="flame"></span><span class="flame small"></span></div>
          <div class="candle" style="transform: rotateX(22deg) translateZ(120px) translateY(-6px);"><span class="flame"></span><span class="flame small"></span></div>
          <div class="candle" style="transform: rotateX(22deg) translateZ(140px) translateY(-12px);"><span class="flame"></span><span class="flame small"></span></div>
          <div class="candle" style="transform: rotateX(22deg) translateZ(110px) translateY(-3px);"><span class="flame"></span><span class="flame small"></span></div>
          <div class="candle" style="transform: rotateX(22deg) translateZ(150px) translateY(-14px);"><span class="flame"></span><span class="flame small"></span></div>
        </div>

        <div class="plate" aria-hidden="true"></div>
      </div>
    </div>

    <div class="caption">С днём рождения! — нажми и тащи, чтобы повернуть</div>

    <div class="controls" aria-hidden="true">
      <div class="btn" id="spinBtn">Автовращение</div>
      <div class="btn" id="stopBtn">Стоп</div>
    </div>
  </div>

  <!-- Лёгкий JavaScript (работает везде) -->
  <script>
    // Управление камерой мышью/тач
    (function(){
      const stage = document.getElementById('stage');
      const scene = document.getElementById('scene');
      let isDown = false;
      let lastX = 0, lastY = 0;
      let rotX = 18, rotY = -12;
      let inertiaX = 0, inertiaY = 0;
      let spinning = false;
      let autoSpinInterval = null;

      function apply(){
        scene.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg)`;
      }

      stage.addEventListener('pointerdown', (e) => {
        isDown = true;
        lastX = e.clientX;
        lastY = e.clientY;
        stage.setPointerCapture(e.pointerId);
        spinning = false;
        clearInterval(autoSpinInterval);
      });

      stage.addEventListener('pointermove', (e) => {
        if (!isDown) return;
        const dx = e.clientX - lastX;
        const dy = e.clientY - lastY;
        rotY += dx * 0.25;
        rotX -= dy * 0.2;
        rotX = Math.max(-45, Math.min(60, rotX));
        inertiaX = dy * 0.08;
        inertiaY = dx * 0.08;
        lastX = e.clientX; lastY = e.clientY;
        apply();
      });

      ['pointerup','pointercancel','pointerleave'].forEach(ev => {
        stage.addEventListener(ev, () => { isDown=false; });
      });

      // лёгкая инерция
      function tick(){
        if (!isDown && (Math.abs(inertiaX)+Math.abs(inertiaY) > 0.01)){
          rotX -= inertiaX;
          rotY += inertiaY;
          inertiaX *= 0.92;
          inertiaY *= 0.92;
          rotX = Math.max(-45, Math.min(60, rotX));
          apply();
        }
        requestAnimationFrame(tick);
      }
      tick();

      // Автовращение
      document.getElementById('spinBtn').addEventListener('click', () => {
        spinning = true;
        autoSpinInterval && clearInterval(autoSpinInterval);
        autoSpinInterval = setInterval(()=> { rotY += 1.2; apply(); }, 16);
      });
      document.getElementById('stopBtn').addEventListener('click', () => {
        spinning = false;
        autoSpinInterval && clearInterval(autoSpinInterval);
      });

      // добавить случайные sprinkles (декор) — делаем прямо сейчас
      const sprinkles = document.getElementById('sprinkles');
      function rand(min,max){ return Math.random()*(max-min)+min; }
      for(let i=0;i<22;i++){
        const s = document.createElement('div');
        s.className='sprinkle';
        const left = rand(12,88);
        const top = rand(24,70);
        const rot = rand(-40,40);
        s.style.left = left + '%';
        s.style.top = top + '%';
        s.style.transform = `translateZ(${rand(70,110)}px) rotate(${rot}deg)`;
        s.style.background = ['#f67','#7fd','#ffd','#9cf','#f9a'][Math.floor(Math.random()*5)];
        s.style.width = (6+Math.round(rand(0,8))) + 'px';
        s.style.height = (4+Math.round(rand(0,6))) + 'px';
        sprinkles.appendChild(s);
      }

      // доступность: при длинном тапе — автовращение
      let pressTimer;
      stage.addEventListener('pointerdown', (e)=>{
        clearTimeout(pressTimer);
        pressTimer = setTimeout(()=> document.getElementById('spinBtn').click(), 700);
      });
      stage.addEventListener('pointerup', ()=> clearTimeout(pressTimer));
    })();
  </script>
</body>
</html>
