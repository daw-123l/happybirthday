<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dark Fantasy Pixel — Cake</title>

<style>
  html,body{
    height:100%;margin:0;background:#050409;
    display:flex;align-items:center;justify-content:center;
    font-family:system-ui;
  }

  .wrap{padding:16px;width:min(900px,96vw);}
  .scene{position:relative;width:100%;max-width:820px;margin:auto;}
  .scene img{width:100%;display:block;image-rendering:pixelated;}

  .overlay{
    position:absolute;left:0;top:0;width:100%;height:100%;
    pointer-events:none;
  }

  /* Луна (без анимации) */
  .pixel-moon{
    position:absolute;
    width:42px;height:42px;
    image-rendering:pixelated;
    left:72%; top:13%;
    opacity:1;
    filter:drop-shadow(0 0 6px rgba(255,255,255,0.45));
  }

  /* Надпись */
  .caption{
    position:absolute;
    width:100%;
    text-align:center;
    bottom:10%;
    font-size:22px;
    font-weight:700;
    color:#ffddb3;
    text-shadow:0 0 8px rgba(255,160,40,0.2);
    pointer-events:none;
  }

  /* Fireflies (фоновые огоньки) */
  .firefly{
    position:absolute;
    width:5px;height:5px;
    border-radius:50%;
    background:rgba(255,210,120,0.95);
    image-rendering:pixelated;
    pointer-events:none;
    mix-blend-mode:screen;
    opacity:0.9;
  }

  @keyframes fireflyBlink {
    0%{opacity:0.3;}
    50%{opacity:1;}
    100%{opacity:0.3;}
  }

  /* Маленькое пламя свечи */
  .flame{
    position:absolute;
    width:8px;height:12px;
    image-rendering:pixelated;
    pointer-events:none;
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="scene" id="scene">
    <img id="bg" src="dark_fantasy_cake.png" alt="cake">

    <div class="overlay" id="overlay">

      <!-- Луна -->
      <img class="pixel-moon"
        src="data:image/png;base64,
        iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAA..."
        alt="moon">

      <!-- Надпись -->
      <div class="caption">С Днём Рождения, Юля!</div>

    </div>
  </div>
</div>

<script>
const overlay = document.getElementById("overlay");
const bg = document.getElementById("bg");

let fireflies = [];
let flames = [];

/* ---------- ПОЗИЦИИ МАЛЕНЬКИХ ПЛАМЕН (ТОЧНО ПО СВЕЧАМ) ---------- */
const flamePositions = [
  {x: 43.8, y: 45.2},
  {x: 46.8, y: 47.9},
  {x: 51.1, y: 44.4},
  {x: 54.0, y: 48.0},
  {x: 57.9, y: 45.35}
];

/* ---------- МАЛЕНЬКОЕ ПЛАМЯ ---------- */
function createFlame(){
  const c=document.createElement("canvas");
  c.width=8;
  c.height=12;
  c.className="flame";
  return c;
}

function drawFlame(c, t){
  const ctx=c.getContext("2d");
  ctx.clearRect(0,0,8,12);

  for(let y=0;y<12;y++){
    const ry=(12-y)/12;
    const w = Math.floor(1 + ry*2);

    const x0 = 4 - w;
    const x1 = 4 + w;

    for(let x=x0;x<=x1;x++){
      let col;
      if(ry>0.7) col="rgb(255,240,190)";
      else if(ry>0.4) col="rgb(255,200,120)";
      else col="rgb(255,140,60)";

      ctx.fillStyle=col;
      ctx.fillRect(x,y,1,1);
    }
  }
}

/* ---------- КООРДИНАТЫ ---------- */
function posPercentToPx(px,py){
  const r=bg.getBoundingClientRect();
  const o=overlay.getBoundingClientRect();
  return{
    x:r.left+r.width*(px/100)-o.left,
    y:r.top+r.height*(py/100)-o.top
  };
}

/* ---------- СОЗДАНИЕ ПЛАМЕН ---------- */
function buildFlames(){
  flames.forEach(f=>f.el.remove());
  flames=[];

  flamePositions.forEach(p=>{
    const c = createFlame();
    overlay.appendChild(c);

    flames.push({
      el:c,
      pos:p,
      t:Math.random()*40
    });
  });
}

function placeFlames(){
  flames.forEach(f=>{
    const pos=posPercentToPx(f.pos.x,f.pos.y);
    f.el.style.left=(pos.x - 4)+"px";
    f.el.style.top=(pos.y - 14)+"px";
  });
}

/* ---------- АНИМАЦИЯ ПЛАМЕН ---------- */
let last=performance.now();
function animateFlames(now){
  const dt=(now-last)/1000;
  last=now;

  flames.forEach(f=>{
    f.t += dt*1.1; // мягкая скорость
    drawFlame(f.el, f.t);

    // лёгкое колебание
    const bob=Math.sin(f.t*2)*0.6;
    f.el.style.transform=`translateY(${bob}px)`;
  });

  requestAnimationFrame(animateFlames);
}

/* ---------- ЛЕТАЮЩИЕ ОГОНЬКИ (Fireflies) ---------- */
function createFireflies(count=35){
  fireflies.forEach(f=>f.el.remove());
  fireflies=[];

  for(let i=0;i<count;i++){
    const f=document.createElement("div");
    f.className="firefly";

    const size=4+Math.random()*3;
    f.style.width=size+"px";
    f.style.height=size+"px";

    f.style.left=(Math.random()*100)+"%";
    f.style.top =(Math.random()*100)+"%";

    f.style.animation=`fireflyBlink ${2+Math.random()*2}s ease-in-out infinite`;

    overlay.appendChild(f);

    fireflies.push({
      el:f,
      x:Math.random()*100,
      y:Math.random()*100,
      dx:(Math.random()-0.5)*0.12,
      dy:(Math.random()-0.5)*0.12
    });
  }
}

function animateFireflies(){
  fireflies.forEach(f=>{
    f.x+=f.dx;
    f.y+=f.dy;

    if(f.x<-5 || f.x>105) f.dx*=-1;
    if(f.y<-5 || f.y>105) f.dy*=-1;

    f.el.style.left=f.x+"%";
    f.el.style.top =f.y+"%";
  });

  requestAnimationFrame(animateFireflies);
}

/* ---------- INIT ---------- */
bg.onload=()=>{
  createFireflies(40);
  animateFireflies();

  buildFlames();
  placeFlames();
  animateFlames(performance.now());
};

window.onresize=()=>placeFlames();

</script>
</body>
</html>
